
// This file was autogenerated by go-to-protobuf. Do not edit it manually!

syntax = 'proto2';

package github.com.open_cluster_management.api.cluster.v1;

import "k8s.io/apimachinery/pkg/api/resource/generated.proto";
import "k8s.io/apimachinery/pkg/apis/meta/v1/generated.proto";
import "k8s.io/apimachinery/pkg/runtime/schema/generated.proto";

// Package-wide variables from generator "generated".
option go_package = "v1";

// ClientConfig represents the apiserver address of the managed cluster.
// TODO include credential to connect to managed cluster kube-apiserver
message ClientConfig {
  // URL is the url of apiserver endpoint of the managed cluster.
  // +required
  optional string url = 1;

  // CABundle is the ca bundle to connect to apiserver of the managed cluster.
  // System certs are used if it is not set.
  // +optional
  optional bytes caBundle = 2;
}

// ManagedCluster represents the desired state and current status of managed
// cluster. ManagedCluster is a cluster scoped resource. The name is the cluster
// UID.
//
// The cluster join process follows a double opt-in process:
//
// 1. agent on managed cluster creates CSR on hub with cluster UID and agent name.
// 2. agent on managed cluster creates ManagedCluster on hub.
// 3. cluster admin on hub approves the CSR for the ManagedCluster's UID and agent name.
// 4. cluster admin sets spec.acceptClient of ManagedCluster to true.
// 5. cluster admin on managed cluster creates credential of kubeconfig to hub.
//
// Once the hub creates the cluster namespace, the Klusterlet agent on the Managed Cluster
// pushes the credential to the hub to use against the managed cluster's kube-apiserver.
message ManagedCluster {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1;

  // Spec represents a desired configuration for the agent on the managed cluster.
  optional ManagedClusterSpec spec = 2;

  // Status represents the current status of joined managed cluster
  // +optional
  optional ManagedClusterStatus status = 3;
}

// ManagedClusterList is a collection of managed cluster.
message ManagedClusterList {
  // Standard list metadata.
  // More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#types-kinds
  // +optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1;

  // Items is a list of managed cluster.
  repeated ManagedCluster items = 2;
}

// ManagedClusterSpec provides the information to securely connect to a remote server
// and verify its identity.
message ManagedClusterSpec {
  // ManagedClusterClientConfigs represents a list of the apiserver address of the managed cluster.
  // If it is empty, managed cluster has no accessible address to be visited from hub.
  // +optional
  repeated ClientConfig managedClusterClientConfigs = 1;

  // hubAcceptsClient represents that hub accepts the join of Klusterlet agent on
  // the managed cluster to the hub. The default value is false, and can only be set
  // true when the user on hub has an RBAC rule to UPDATE on the virtual subresource
  // of managedclusters/accept.
  // When the value is set true, a namespace whose name is same as the name of ManagedCluster
  // is created on hub representing the managed cluster, also role/rolebinding is created on
  // the namespace to grant the permision of access from agent on managed cluster.
  // When the value is set false, the namespace representing the managed cluster is
  // deleted.
  // +required
  optional bool hubAcceptsClient = 2;

  // LeaseDurationSeconds is used to coordinate the lease update time of Klusterlet agents on the managed cluster.
  // If its value is zero, the Klusterlet agent will update its lease every 60s by default
  // +optional
  optional int32 leaseDurationSeconds = 3;
}

// ManagedClusterStatus represents the current status of joined managed cluster.
message ManagedClusterStatus {
  // Conditions contains the different condition statuses for this managed cluster.
  repeated StatusCondition conditions = 1;

  // Capacity represents the total resource capacity from all nodeStatuses
  // on the managed cluster.
  map<string, k8s.io.apimachinery.pkg.api.resource.Quantity> capacity = 2;

  // Allocatable represents the total allocatable resources on the managed cluster.
  map<string, k8s.io.apimachinery.pkg.api.resource.Quantity> allocatable = 3;

  // Version represents the kubernetes version of the managed cluster.
  optional ManagedClusterVersion version = 4;
}

// ManagedClusterVersion represents version information about the managed cluster.
// TODO add managed agent versions
message ManagedClusterVersion {
  // Kubernetes is the kubernetes version of managed cluster.
  // +optional
  optional string kubernetes = 1;
}

// StatusCondition contains condition information for a managed cluster.
message StatusCondition {
  // Type is the type of the cluster condition.
  // +required
  optional string type = 1;

  // Status is the status of the condition. One of True, False, Unknown.
  // +required
  optional string status = 2;

  // LastTransitionTime is the last time the condition changed from one status to another.
  // +required
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 3;

  // Reason is a (brief) reason for the condition's last status change.
  // +required
  optional string reason = 4;

  // Message is a human-readable message indicating details about the last status change.
  // +required
  optional string message = 5;
}

